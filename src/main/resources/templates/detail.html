<html lang="en" layout:decorate="~{layout}">
<div layout:fragment="content" class="w-[1000px] mx-auto">
    <div class="flex flex-col gap-7">
        <p>글쓴이</p>
    <span th:if="${article.author != null}" th:text="${article.author.nickname}"></span>
    <h2 class="text-4xl">Title</h2>
        <span class="w=[50%] border-4" th:text="${article.title}"></span>
    <p class="text-2xl">Content</p>
        <span class="border-4" th:text="${article.content}"></span>
    </div>
    <div th:if="${#lists.isEmpty(comments)}">댓글이 없습니다.</div>
    <div th:each="comment : ${article.comments}">
        <p><strong th:text="${comment.nickname}"></strong> <span th:text="${comment.createdDate}"></span></p>
        <p th:text="${comment.comment}"></p>

        <div sec:authorize="isAuthenticated()" th:if="${comment.author !=null and #authentication.getPrincipal().getUsername() == comment.author.loginId}" class="flex flex-row">
            <form th:action="@{|/comment/update/${comment.id}|}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="commentId" th:value="${comment.id}" />
                <textarea name="comment" th:text="${comment.comment}"></textarea>
                <input type="submit" value="수정!" class="btn">
            </form>
            <form th:action="@{|/comment/delete/${comment.id}|}">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="commentId" th:value="${comment.id}" />
                <input type="submit" value="삭제!" class="btn" style="margin-top: 17px;">
            </form>
        </div>
    </div>

    <div th:if="${#authentication.principal != null}">
        <form action="/comment/create" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <input type="hidden" name="articleId" th:value="${article.id}"/>
            <textarea name="comment" placeholder="댓글을 입력하세요"></textarea>
            <input type="submit" value="댓글 작성" class="btn">
        </form>
    </div>
    <div class="flex justify-end gap-7">
    <a th:href="@{|/article/update/${article.id}|}" sec:authorize="isAuthenticated()"
       th:if="${article.author !=null and #authentication.getPrincipal().getUsername() == article.author.loginId}" th:text="수정" class="btn"></a>
    <a th:href="@{|/article/delete/${article.id}|}" sec:authorize="isAuthenticated()"
       th:if="${article.author !=null and #authentication.getPrincipal().getUsername() == article.author.loginId}" th:text="삭제" class="btn"></a>
        <a href="/article/list" class="btn">목록으로</a>
    </div>
<!--    <div th:if="${#authentication.principal == null}">-->
<!--        <p>댓글을 작성하려면 <a th:href="@{/login}">로그인</a>이 필요합니다.</p>-->
<!--    </div>-->
</div>
</html>